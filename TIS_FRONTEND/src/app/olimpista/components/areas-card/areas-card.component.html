<div class="olimpista__card bg-blue-50 shadow-md rounded-lg overflow-hidden">
  <div class="p-4">
    <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ Area.nombre_area }}</h3>
    <p class="px-2 py-2 text-sm font-semibold-500">{{ Area.descripcion }}</p>

    <!-- Contenedor de Categorías -->
    <div class="border border-gray-200 p-4 bg-white rounded-lg">
      <h4 class="text-md font-semibold text-gray-700 mb-3">Categorías</h4>

      <!-- Loading State -->
      <div *ngIf="loading" class="text-center py-4">
        <span class="text-blue-500">Cargando categorías...</span>
      </div>

      <!-- Verifica si hay categorías -->
      <div *ngIf="!loading && categorias.length > 0; else noCategorias">
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
          <div *ngFor="let categoria of categorias; let i = index" class="bg-white shadow-md rounded-lg overflow-hidden">
            <!-- Parte superior con color teal -->
            <div class="bg-teal-600 p-4 text-white">
              <h3 class="text-lg font-semibold">{{ categoria.nombre_nivel }}</h3>
              <p class="text-sm">{{ categoria.descripcion || 'Sin descripción' }}</p>
            </div>
            
            <!-- Parte inferior blanca con detalles -->
            <div class="p-4">
              <p class="text-sm"><strong>Fecha de examen:</strong> {{ categoria.fecha_examen | date:'dd/MM/yyyy' || 'No definida' }}</p>
              <p class="text-sm"><strong>Costo:</strong> {{ categoria.costo | currency:'Bs ' }}</p>
              
              <!-- Botones de acción -->
              <div class="mt-4 flex justify-between">
                <button (click)="openEditModal(i)" 
                        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                  Editar
                </button>
                <button (click)="openConfirmModal(i)" 
                        class="px-4 py-2 {{ categoria.habilitacion ? 'bg-red-500' : 'bg-green-500' }} text-white rounded hover:{{ categoria.habilitacion ? 'bg-red-600' : 'bg-green-600' }}">
                  {{ categoria.habilitacion ? 'Deshabilitar' : 'Habilitar' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mensaje si no hay categorías -->
      <ng-template #noCategorias>
        <p class="text-gray-500 text-sm italic py-4">
          {{ loading ? '' : 'No hay categorías registradas para esta área.' }}
        </p>
      </ng-template>

      <!-- Botón para abrir el modal -->
      <button class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" 
              (click)="openModal()"
              [disabled]="loading">
        Añadir categoría
      </button>
    </div>
  </div>
</div>

<!-- Modal de Confirmación -->
<div *ngIf="isConfirmModalOpen" class="fixed inset-0 flex items-center justify-center bg-gray-600 bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96">
    <h2 class="text-lg font-bold">Confirmación</h2>
    <p class="text-sm text-gray-600">
      ¿Estás seguro de que deseas {{ categoriaIndexToToggle !== null && 
      categorias[categoriaIndexToToggle]?.habilitacion ? 'deshabilitar' : 'habilitar' }} esta categoría?
    </p>
    <div class="mt-4 flex justify-end space-x-2">
      <button (click)="toggleHabilitar()" 
              class="px-4 py-2 {{ categoriaIndexToToggle !== null && categorias[categoriaIndexToToggle]?.habilitacion ? 'bg-red-500' : 'bg-green-500' }} text-white rounded hover:{{ categoriaIndexToToggle !== null && categorias[categoriaIndexToToggle]?.habilitacion ? 'bg-red-600' : 'bg-green-600' }}"
              [disabled]="loading">
        Sí, {{ categoriaIndexToToggle !== null && categorias[categoriaIndexToToggle]?.habilitacion ? 'deshabilitar' : 'habilitar' }}
      </button>
      <button (click)="closeConfirmModal()" 
              class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
              [disabled]="loading">
        Cancelar
      </button>
    </div>
  </div>
</div>

<!-- Modal para añadir categoría -->
<div *ngIf="isModalOpen" class="fixed inset-0 bg-gray-600 flex justify-center items-center"
  style="background-color: rgba(75, 85, 99, 0.3);">
  <div class="bg-white p-5 rounded-lg shadow-lg max-w-md"
    style="width: 600px; height: 500px; background-color:rgba(206, 223, 255, 100);">

    <!-- Título Principal -->
    <h2 class="text-xl font-bold text-gray-900">Añadir Categoría</h2>
    <p class="text-sm text-gray-500 mb-4">Introduce los detalles de la categoría.</p>

    <!-- Formulario para la categoría -->
    <form (ngSubmit)="saveCategory()">

    <!-- Nombre de Categoría -->
    <label class="text-sm text-gray-700">Nombre de la Categoría</label>
    <input type="text" placeholder="Ingresar nombre de la categoría"
      class="mt-2 p-2 border border-gray-300 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
      [(ngModel)]="nuevaCategoria.nombre_nivel"
      name="nombre_nivel" 
      required
      [disabled]="loading"
      style="background-color: white;">

    <!-- Nivel Académico -->
    <label class="text-sm text-gray-700 mt-4 block">Descripción/Nivel</label>
    <select class="mt-2 p-2 border border-gray-300 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
      [(ngModel)]="nuevaCategoria.descripcion"
      name="descripcion" 
      [disabled]="loading"
      style="background-color: white;">
      <option value="" disabled selected class="text-gray-400">Seleccionar nivel académico</option>
      <option value="1ro de Primaria">1ro de Primaria</option>
      <option value="2do de Primaria">2do de Primaria</option>
      <option value="3ro de Primaria">3ro de Primaria</option>
      <option value="4to de Primaria">4to de Primaria</option>
      <option value="5to de Primaria">5to de Primaria</option>
      <option value="6to de Primaria">6to de Primaria</option>
      <option value="1ro de Secundaria">1ro de Secundaria</option>
      <option value="2do de Secundaria">2do de Secundaria</option>
      <option value="3ro de Secundaria">3ro de Secundaria</option>
      <option value="4to de Secundaria">4to de Secundaria</option>
      <option value="5to de Secundaria">5to de Secundaria</option>
      <option value="6to de Secundaria">6to de Secundaria</option>
    </select>

    <!-- Fecha de examen -->
    <label class="text-sm text-gray-700 mt-4 block">Fecha de examen</label>
    <input type="date" placeholder="Ingresar fecha de examen"
      class="mt-2 p-2 border border-gray-300 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
      [(ngModel)]="nuevaCategoria.fecha_examen"
      name="fecha_examen"
      [disabled]="loading"
      style="background-color: white;">

    <!-- Costo de la Categoría -->
    <label class="text-sm text-gray-700 mt-4 block">Costo de la Categoría</label>
    <input type="number" placeholder="Ingresar costo"
      class="mt-2 p-2 border border-gray-300 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
      [(ngModel)]="nuevaCategoria.costo"
      name="costo"
      required
      min="0"
      step="0.01"
      [disabled]="loading"
      style="background-color: white;">

    <!-- Habilitación -->
    <label class="text-sm text-gray-700 mt-4 block flex items-center">
      <input type="checkbox" [(ngModel)]="nuevaCategoria.habilitacion" 
             name="habilitacion" class="mr-2"
             [disabled]="loading">
      Habilitar categoría
    </label>

    <!-- Botones de acción -->
    <div class="mt-5 flex justify-end gap-4">
      <button type="submit" 
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
              [disabled]="loading">
        {{ loading ? 'Guardando...' : 'Aceptar' }}
      </button>
      <button type="button" 
              (click)="closeModal()" 
              class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
              [disabled]="loading">
        Cancelar
      </button>
    </div>
    </form>
  </div>
</div>

<!-- Modal de Edición de Categoría -->
<div *ngIf="isEditModalOpen" class="fixed inset-0 bg-gray-600 flex justify-center items-center"
  style="background-color: rgba(75, 85, 99, 0.3);">
  <div class="bg-white p-5 rounded-lg shadow-lg max-w-md" style="width: 600px; height: 500px;">
    <h2 class="text-xl font-bold text-gray-900">Editar Categoría</h2>
    <p class="text-sm text-gray-500 mb-4">Modifica los datos de la categoría.</p>

    <form (ngSubmit)="saveEdit()">
      <!-- Nombre de Categoría -->
      <label class="text-sm text-gray-700">Nombre de la Categoría</label>
      <input type="text" [(ngModel)]="editedCategoria.nombre_nivel" name="nombre_nivel"
        class="mt-2 p-2 border border-gray-300 rounded w-full focus:ring-2 focus:ring-blue-400"
        required
        [disabled]="loading">

      <!-- Descripción -->
      <label class="text-sm text-gray-700 mt-4 block">Descripción/Nivel</label>
      <select class="mt-2 p-2 border border-gray-300 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
        [(ngModel)]="editedCategoria.descripcion"
        name="descripcion" 
        [disabled]="loading">
        <option value="" disabled selected class="text-gray-400">Seleccionar nivel académico</option>
        <option value="1ro de Primaria">1ro de Primaria</option>
        <option value="2do de Primaria">2do de Primaria</option>
        <!-- Resto de opciones... -->
      </select>

      <!-- Fecha de examen -->
      <label class="text-sm text-gray-700 mt-4 block">Fecha de examen</label>
      <input type="date" [(ngModel)]="editedCategoria.fecha_examen" name="fecha_examen"
        class="mt-2 p-2 border border-gray-300 rounded w-full focus:ring-2 focus:ring-blue-400"
        [disabled]="loading">

      <!-- Costo -->
      <label class="text-sm text-gray-700 mt-4 block">Costo</label>
      <input type="number" [(ngModel)]="editedCategoria.costo" name="costo"
        class="mt-2 p-2 border border-gray-300 rounded w-full focus:ring-2 focus:ring-blue-400"
        required min="0" step="0.01"
        [disabled]="loading">

      <!-- Habilitación -->
      <label class="text-sm text-gray-700 mt-4 block flex items-center">
        <input type="checkbox" [(ngModel)]="editedCategoria.habilitacion" 
               name="habilitacion" class="mr-2"
               [disabled]="loading">
        Habilitar categoría
      </label>

      <!-- Botones -->
      <div class="mt-5 flex justify-end gap-2">
        <button type="submit" 
                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                [disabled]="loading">
          {{ loading ? 'Guardando...' : 'Guardar' }}
        </button>
        <button type="button" 
                (click)="closeEditModal()" 
                class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                [disabled]="loading">
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>