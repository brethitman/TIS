<div class="space-y-8">
  <!-- Sección creación de áreas -->
  <div class="p-4 bg-blue-50 rounded-lg">
    <h2 class="text-xl font-semibold text-blue-800 mb-3">Gestión de Áreas</h2>
    <app-crear-area 
      *ngIf="idOlimpiada"
      [idOlimpiada]="idOlimpiada"
      class="block mb-4"
    ></app-crear-area>
    <p class="text-gray-600">Desde aquí podrás crear nuevas áreas para la olimpiada.</p>
  </div>

  <!-- Listado de áreas existentes -->
  <div class="p-6 container mx-auto">
    <h1 class="text-2xl font-bold mb-6 text-blue-800">Áreas y Categorías Existentes</h1>

    <!-- Estados de carga -->
    <div *ngIf="cargando" class="text-center text-blue-600 animate-pulse">
      <i class="fas fa-spinner fa-spin mr-2"></i>Cargando áreas...
    </div>

    <!-- Manejo de errores generales -->
    <div *ngIf="errorCarga" class="p-4 bg-red-50 text-red-700 rounded-lg text-center mb-4">
      ⚠️ {{ errorCarga }}
    </div>

    <!-- Listado de áreas -->
    <div *ngIf="!cargando && !errorCarga">
      <!-- Caso sin áreas -->
      <div *ngIf="areas.length === 0" class="text-center text-gray-500 p-8 border-2 border-dashed rounded-xl">
        No se han encontrado áreas registradas
      </div>

      <!-- Áreas existentes -->
      <div *ngIf="areas.length > 0" class="space-y-8">
        <div *ngFor="let area of areas" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition-shadow">
          <div class="mb-4">
            <h2 class="text-2xl font-semibold text-gray-800">{{ area.nombre_area }}</h2>
            <p class="text-gray-600 mt-1">{{ area.descripcion || 'Sin descripción' }}</p>
          </div>

          <!-- Sección de niveles -->
          <div class="border-t pt-4">
            <!-- Encabezado y botón -->
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold text-gray-800">Niveles asociados</h3>
              <button 
                (click)="toggleFormulario(area.id_area)"
                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm transition-colors"
              >
                {{ areaActiva === area.id_area ? 'Cancelar' : '+ Nuevo Nivel' }}
              </button>
            </div>

            <!-- Mensajes de error del formulario -->
            <div *ngIf="errores.length > 0 && areaActiva === area.id_area" class="mb-4 p-3 bg-red-50 text-red-700 rounded-lg">
              <ul class="list-disc pl-4">
                <li *ngFor="let error of errores" class="mb-1 last:mb-0">{{ error }}</li>
              </ul>
            </div>

            <!-- Formulario nuevo nivel -->
            <div *ngIf="areaActiva === area.id_area" class="bg-gray-50 p-4 rounded-lg mb-6">
              <form (ngSubmit)="crearNivel(area.id_area)" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Campos del formulario -->
                <div class="space-y-2">
                  <label class="block text-sm font-medium text-gray-700 required">Nombre del nivel</label>
                  <input
                    type="text"
                    [(ngModel)]="nuevoNivel.nombre_nivel"
                    name="nombre_nivel"
                    required
                    class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                  >
                </div>

                <div class="space-y-2">
                  <label class="block text-sm font-medium text-gray-700 required">Grado inicial</label>
                  <input
                    type="text"
                    [(ngModel)]="nuevoNivel.gradoIniCat"
                    name="gradoIniCat"
                    required
                    class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                  >
                </div>

                <div class="space-y-2">
                  <label class="block text-sm font-medium text-gray-700 required">Grado final</label>
                  <input
                    type="text"
                    [(ngModel)]="nuevoNivel.gradoFinCat"
                    name="gradoFinCat"
                    required
                    class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                  >
                </div>

                <div class="space-y-2">
                  <label class="block text-sm font-medium text-gray-700 required">Fecha examen</label>
                  <input
                    type="date"
                    [(ngModel)]="nuevoNivel.fecha_examen"
                    name="fecha_examen"
                    required
                    class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                  >
                </div>

                <div class="space-y-2">
                  <label class="block text-sm font-medium text-gray-700 required">Costo (USD)</label>
                  <input
                    type="number"
                    [(ngModel)]="nuevoNivel.costo"
                    name="costo"
                    step="0.01"
                    required
                    class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                  >
                </div>

                <div class="space-y-2">
                  <label class="block text-sm font-medium text-gray-700">Habilitado</label>
                  <select
                    [(ngModel)]="nuevoNivel.habilitacion"
                    name="habilitacion"
                    class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                  >
                    <option [value]="1">Sí</option>
                    <option [value]="0">No</option>
                  </select>
                </div>

                <div class="md:col-span-2 space-y-2">
                  <label class="block text-sm font-medium text-gray-700">Descripción</label>
                  <textarea
                    [(ngModel)]="nuevoNivel.descripcion"
                    name="descripcion"
                    class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 h-24"
                  ></textarea>
                </div>

                <!-- Botones de acción -->
                <div class="md:col-span-2 flex justify-end gap-2">
                  <button
                    type="button"
                    (click)="toggleFormulario(area.id_area)"
                    class="px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400 transition-colors"
                  >
                    Cancelar
                  </button>
                  <button
                    type="submit"
                    [disabled]="enviando || errores.length > 0"
                    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                  >
                    {{ enviando ? 'Creando...' : 'Crear Nivel' }}
                  </button>
                </div>
              </form>
            </div>

            <!-- Listado de niveles existentes -->
            <div *ngIf="!area.nivel_categorias?.length" class="text-gray-400 italic py-2">
              No se han definido niveles para esta área
            </div>

            <div *ngIf="area.nivel_categorias?.length" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div *ngFor="let nivel of area.nivel_categorias" class="bg-gray-50 p-4 rounded-lg border border-gray-100 hover:bg-white transition-colors">
                <h4 class="text-lg font-semibold text-gray-700 mb-2">{{ nivel.nombre_nivel }}</h4>
                
                <div class="space-y-1.5 text-sm">
                  <p *ngIf="nivel.descripcion" class="text-gray-500 italic">
                    {{ nivel.descripcion }}
                  </p>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Fecha examen:</span>
                    <span class="font-medium text-gray-700">
                      {{ nivel.fecha_examen | date:'dd/MM/yyyy' }}
                    </span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Costo:</span>
                    <span class="font-medium text-gray-700">
                      {{ nivel.costo | currency:'USD':'symbol':'1.2-2' }}
                    </span>
                  </div>
                 <!-- En la sección del estado -->
<div class="flex justify-between">
  <span class="text-gray-600">Estado:</span>
  <span 
    [ngClass]="{
      'text-green-600': nivel.habilitacion === 1,
      'text-red-600': nivel.habilitacion === 0
    }" 
    class="font-medium"
  >
    {{ getEstadoTexto(nivel.habilitacion) }}
  </span>
</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>